<template>
  <div class="doc-container">
    <div class="doc-sidebar">
      <div class="sidebar-header">
        <el-icon><Reading /></el-icon> <span>CONTENTS</span>
      </div>
      <ul class="toc-list">
        <li 
          v-for="(item, index) in toc" 
          :key="index"
          :class="{ active: activeSection === item.id, 'sub-item': item.level > 1 }"
          @click="scrollTo(item.id)"
        >
          {{ item.text }}
        </li>
      </ul>
    </div>

    <div class="doc-content markdown-body" ref="contentRef" @scroll="handleScroll">
      <div v-html="parsedMarkdown"></div>
      
      <div class="doc-footer">
        Generated by Hometown System Generator &copy; 2025
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted, nextTick } from 'vue'
import { Reading } from '@element-plus/icons-vue'
import { marked } from 'marked'
import hljs from 'highlight.js'
import 'highlight.js/styles/github-dark-dimmed.css' // å¼•å…¥ä»£ç é«˜äº®æ ·å¼

// --- ğŸ“ é¡¹ç›®æ ¸å¿ƒæ–‡æ¡£ (Markdown) ---
const markdownContent = `
# è¡¢å·åœ°åŒºä¿¡æ¯ç®¡ç†ç³»ç»Ÿ (Hometown Management System)

> **ç‰ˆæœ¬**: v1.0.0 
> **å¼€å‘è€…**: æ¯›é–æ™¨ (23H034160336)  
> **çŠ¶æ€**: ğŸš€ å·²å®Œæˆ (Stable)

---

## 1. é¡¹ç›®æ¦‚è¿° (Overview)

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªè‡´åŠ›äº**å¼˜æ‰¬è¡¢å·æ–‡åŒ–ã€æ¨å¹¿åœ°æ–¹ç‰¹è‰²**çš„å…¨æ ˆä¿¡æ¯ç®¡ç†å¹³å°ã€‚ç³»ç»Ÿé›†æˆäº†**æ–‡åŒ–é—äº§å±•ç¤ºã€ç‰¹äº§æ¨å¹¿ã€æ—…æ¸¸æ™¯ç‚¹å¯¼èˆª**ä»¥åŠ**åå°æ•°æ®å¯è§†åŒ–ç®¡ç†**ç­‰åŠŸèƒ½ï¼Œæ—¨åœ¨é€šè¿‡æ•°å­—åŒ–æ‰‹æ®µï¼Œè®©æ›´å¤šäººäº†è§£â€œå—å­”åœ£åœ°Â·è¡¢å·æœ‰ç¤¼â€çš„ç‹¬ç‰¹é­…åŠ›ã€‚

é¡¹ç›®é‡‡ç”¨**å‰åç«¯åˆ†ç¦»**æ¶æ„ï¼Œåˆ†ä¸ºä¸‰ä¸ªç‹¬ç«‹å­ç³»ç»Ÿï¼š
1.  **åç«¯æœåŠ¡ (Core Server)**: åŸºäº Spring Boot çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸æ•°æ®æ¥å£ã€‚
2.  **ç®¡ç†åå° (Admin Dashboard)**: åŸºäº Vue3 + Element Plus çš„æ•°æ®ç®¡ç†ä¸å¯è§†åŒ–å¹³å°ã€‚
3.  **ç”¨æˆ·å‰å° (User Client)**: é¢å‘æ¸¸å®¢çš„æ²‰æµ¸å¼æ–‡åŒ–å±•ç¤ºé—¨æˆ·ã€‚

---

## 2. æŠ€æœ¯æ ˆ (Tech Stack)

### ğŸ› ï¸ åç«¯ (Backend)
-   **æ ¸å¿ƒæ¡†æ¶**: Spring Boot 2.7.x
-   **ORM**: MyBatis / MyBatis-Plus
-   **æ•°æ®åº“**: MySQL 8.0
-   **ç¼“å­˜**: Redis (ç”¨äºä¼šè¯ç®¡ç†ä¸çƒ­ç‚¹æ•°æ®ç¼“å­˜)
-   **å®‰å…¨**: JWT (JSON Web Token) é‰´æƒ, æ‹¦æˆªå™¨æœºåˆ¶
-   **å·¥å…·**: Swagger/Knife4j (æ¥å£æ–‡æ¡£), Lombok, FastJSON
-   **äº‘æœåŠ¡**: é˜¿é‡Œäº‘ OSS (å¯¹è±¡å­˜å‚¨)

### ğŸ’» å‰ç«¯ç®¡ç†ç«¯ (Admin)
-   **æ¡†æ¶**: Vue 3 (Composition API)
-   **æ„å»º**: Vite 4.x
-   **UI ç»„ä»¶åº“**: Element Plus
-   **å›¾è¡¨**: ECharts 5.x (æ•°æ®å¤§å±)
-   **è·¯ç”±**: Vue Router 4
-   **HTTP**: Axios (å°è£…è¯·æ±‚æ‹¦æˆªå™¨)

### ğŸ“± å‰ç«¯ç”¨æˆ·ç«¯ (User)
-   **æ¡†æ¶**: Vue 3
-   **è§†è§‰**: Three.js (éƒ¨åˆ†3Dæ•ˆæœ), CSS3 Animations
-   **å¸ƒå±€**: å“åº”å¼è®¾è®¡ (é€‚é… PC ä¸ç§»åŠ¨ç«¯)

---

## 3. ç³»ç»Ÿæ¶æ„ (Architecture)

\`\`\`mermaid
graph TD
    User[ç”¨æˆ·] -->|æµè§ˆ/äº¤äº’| Client(ç”¨æˆ·å‰å°)
    Admin[ç®¡ç†å‘˜] -->|ç®¡ç†æ•°æ®| Dashboard(ç®¡ç†åå°)
    
    Client -->|API è¯·æ±‚| Gateway[Nginx / ç½‘å…³]
    Dashboard -->|API è¯·æ±‚| Gateway
    
    Gateway --> Server(Spring Boot åç«¯)
    
    Server -->|è¯»å†™| DB[(MySQL æ•°æ®åº“)]
    Server -->|ç¼“å­˜| Cache[(Redis)]
    Server -->|å­˜å‚¨å›¾ç‰‡| OSS[é˜¿é‡Œäº‘ OSS]
\`\`\`

---

## 4. æ ¸å¿ƒåŠŸèƒ½æ¨¡å— (Modules)

### ğŸ›ï¸ æ–‡åŒ–é—äº§ (Culture)
-   **éé—å±•ç¤º**: æ”¶å½•è¡¢å·å„ç±»éç‰©è´¨æ–‡åŒ–é—äº§ã€‚
-   **å›¾æ–‡è¯¦æƒ…**: æ”¯æŒå¯Œæ–‡æœ¬ä¸é«˜æ¸…å¤§å›¾å±•ç¤ºã€‚
-   **åå°ç®¡ç†**: CRUD æ“ä½œï¼Œæ”¯æŒä¸€é”®å‘å¸ƒä¸ä¸‹æ¶ã€‚

### ğŸ— ç‰¹äº§ç¾é£Ÿ (Specialties)
-   **ç‰¹äº§åå½•**: ä¸‰å¤´ä¸€æŒã€çƒ¤é¥¼ç­‰ç‰¹è‰²ç¾é£Ÿä»‹ç»ã€‚
-   **æ¨èç®—æ³•**: (è®¡åˆ’ä¸­) åŸºäºç”¨æˆ·å–œå¥½çš„ä¸ªæ€§åŒ–æ¨èã€‚

### ğŸï¸ æ™¯ç‚¹å¯¼èˆª (Attractions)
-   **æ™¯ç‚¹åº“**: çƒ‚æŸ¯å±±ã€å­”åº™ã€é¾™æ¸¸çŸ³çªŸç­‰æ ¸å¿ƒæ™¯ç‚¹ã€‚
-   **åœ°å›¾å®šä½**: é›†æˆåœ°ç†ä½ç½®ä¿¡æ¯ã€‚
-   **è¯„åˆ†ç³»ç»Ÿ**: ç”¨æˆ·å¯å¯¹æ™¯ç‚¹è¿›è¡Œæ‰“åˆ†ä¸è¯„è®ºã€‚

### ğŸ“Š æ•°æ®å¤§å± (Dashboard)
-   **å®æ—¶ç›‘æ§**: ç”¨æˆ·è®¿é—®é‡ã€API è°ƒç”¨é¢‘ç‡ã€‚
-   **å¯è§†åŒ–**: ä½¿ç”¨ ECharts å±•ç¤ºâ€œç‰¹äº§åˆ†ç±»å æ¯”â€ã€â€œçƒ­é—¨æ™¯ç‚¹æ’è¡Œâ€ç­‰å›¾è¡¨ã€‚

### ğŸ“ æ—¥å¿—å®¡è®¡ (Audit Log)
-   **æ“ä½œæ—¥å¿—**: è®°å½•ç®¡ç†å‘˜çš„æ‰€æœ‰æ•æ„Ÿæ“ä½œ (æ–°å¢ã€åˆ é™¤ã€ä¿®æ”¹)ã€‚
-   **ç™»å½•æ—¥å¿—**: ç›‘æ§å¼‚å¸¸ç™»å½•è¡Œä¸ºï¼Œä¿éšœç³»ç»Ÿå®‰å…¨ã€‚

---

## 5. æ ¸å¿ƒä»£ç ç‰‡æ®µ (Code Snippets)

### ğŸ” 1. JWT ä»¤ç‰Œç”Ÿæˆ (Java)
\`\`\`java
public static String createJWT(String secretKey, long ttlMillis, Map<String, Object> claims) {
    // æŒ‡å®šç­¾åç®—æ³•
    SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;
    // ç”ŸæˆJWTçš„æ—¶é—´
    long expMillis = System.currentTimeMillis() + ttlMillis;
    Date exp = new Date(expMillis);

    // è®¾ç½®jwtçš„body
    JwtBuilder builder = Jwts.builder()
            .setClaims(claims)
            .signWith(signatureAlgorithm, secretKey.getBytes(StandardCharsets.UTF_8))
            .setExpiration(exp);
    return builder.compact();
}
\`\`\`

### ğŸ“¡ 2. Axios è¯·æ±‚æ‹¦æˆªå™¨ (JavaScript)
\`\`\`javascript
service.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('token')
    if (token) {
      config.headers['token'] = token // ç»Ÿä¸€æºå¸¦ Token
    }
    return config
  },
  (error) => {
    return Promise.reject(error)
  }
)
\`\`\`

---

## 6. éƒ¨ç½²æŒ‡å— (Deployment)

### ç¯å¢ƒè¦æ±‚
-   JDK 1.8+
-   Node.js 16+
-   MySQL 5.7+
-   Redis 5.0+

### å¯åŠ¨æ­¥éª¤
1.  **æ•°æ®åº“**: å¯¼å…¥ \`init.sql\` åˆå§‹åŒ–è¡¨ç»“æ„ä¸æ•°æ®ã€‚
2.  **åç«¯**: ä¿®æ”¹ \`application.yml\` ä¸­çš„ DB/Redis é…ç½®ï¼Œè¿è¡Œ \`HometownApplication.java\`ã€‚
3.  **å‰ç«¯**: 
    \`\`\`bash
    cd vue_hometown_management
    npm install
    npm run dev
    \`\`\`

---

## 7. æ›´æ–°æ—¥å¿— (Changelog)

-   **v1.0.3 (2025-12-18)**: 
    -   âœ¨ æ–°å¢â€œç³»ç»Ÿè¿›åŒ– (DevLog)â€æ¨¡å—ï¼Œæ”¯æŒå¤šä»“åº“æäº¤è®°å½•æŸ¥çœ‹ã€‚
    -   ğŸ› ä¿®å¤äº†æ™¯ç‚¹å›¾ç‰‡ä¸Šä¼ ä¸æ˜¾ç¤ºçš„ Bugã€‚
-   **v1.0.2 (2025-12-17)**: 
    -   ğŸ’„ ä¼˜åŒ–åå° UIï¼Œå¢åŠ èµ›åšæœ‹å…‹é£æ ¼ç»„ä»¶ã€‚
    -   ğŸ“ˆ å®Œå–„ ECharts æ•°æ®å¤§å±ã€‚
-   **v1.0.0 (2025-12-01)**: 
    -   ğŸ‰ é¡¹ç›®åˆå§‹åŒ–ï¼Œå®ŒæˆåŸºç¡€ CRUD åŠŸèƒ½ã€‚

---

> **Copyright**: 2025 è¡¢å·åœ°åŒºä¿¡æ¯ç®¡ç†ç³»ç»Ÿ Team. All Rights Reserved.
`

// --- é€»è¾‘å¤„ç† ---
const contentRef = ref(null)
const activeSection = ref('')

// é…ç½® Marked
marked.setOptions({
  renderer: new marked.Renderer(),
  highlight: function(code, lang) {
    const language = hljs.getLanguage(lang) ? lang : 'plaintext';
    return hljs.highlight(code, { language }).value;
  },
  langPrefix: 'hljs language-', // highlight.js css expects a top-level 'hljs' class.
  pedantic: false,
  gfm: true,
  breaks: false,
  sanitize: false,
  smartLists: true,
  smartypants: false,
  xhtml: false
});

const parsedMarkdown = computed(() => marked(markdownContent))

// ç”Ÿæˆç›®å½• (TOC)
const toc = computed(() => {
  const reg = /^#+\s+(.*)$/gm
  const matches = markdownContent.match(reg) || []
  return matches.map((item, index) => {
    const level = item.match(/^#+/)[0].length
    const text = item.replace(/^#+\s+/, '')
    const id = `heading-${index}`
    return { level, text, id }
  })
})

// ä¸ºç”Ÿæˆçš„ HTML æ·»åŠ  ID ä»¥ä¾¿è·³è½¬
onMounted(async () => {
  await nextTick()
  const headers = contentRef.value.querySelectorAll('h1, h2, h3')
  headers.forEach((header, index) => {
    header.id = `heading-${index}`
  })
})

// æ»šåŠ¨è·³è½¬
const scrollTo = (id) => {
  const el = document.getElementById(id)
  if (el) {
    el.scrollIntoView({ behavior: 'smooth' })
    activeSection.value = id
  }
}

// ç›‘å¬æ»šåŠ¨æ›´æ–°ç›®å½•é«˜äº® (ç®€åŒ–ç‰ˆ)
const handleScroll = () => {
  // å®é™…é¡¹ç›®ä¸­å¯ä»¥ä½¿ç”¨ IntersectionObserver å®ç°æ›´ç²¾å‡†çš„ç›‘å¬
}
</script>

<style scoped>
/* å®¹å™¨å¸ƒå±€ */
.doc-container {
  display: flex;
  height: 100%;
  background-color: #ffffff;
  font-family: 'Segoe UI', sans-serif;
  overflow: hidden; /* é˜²æ­¢å¤–å±‚æ»šåŠ¨ */
}

/* å·¦ä¾§ç›®å½• */
.doc-sidebar {
  width: 280px;
  background-color: #f8f9fa;
  border-right: 1px solid #e9ecef;
  padding: 30px 20px;
  overflow-y: auto;
  flex-shrink: 0;
}

.sidebar-header {
  font-size: 14px;
  font-weight: 800;
  color: #adb5bd;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 8px;
  letter-spacing: 1px;
}

.toc-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.toc-list li {
  padding: 8px 12px;
  font-size: 14px;
  color: #495057;
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.2s;
  margin-bottom: 4px;
  border-left: 3px solid transparent;
}

.toc-list li:hover {
  background-color: #e9ecef;
  color: #212529;
}

.toc-list li.active {
  background-color: #e7f5ff;
  color: #1a5e38; /* ä¸»é¢˜è‰² */
  border-left-color: #1a5e38;
  font-weight: 600;
}

.toc-list li.sub-item {
  padding-left: 25px;
  font-size: 13px;
  color: #868e96;
}

/* å³ä¾§å†…å®¹ (Markdown æ ·å¼) */
.doc-content {
  flex: 1;
  padding: 40px 60px;
  overflow-y: auto;
  scroll-behavior: smooth;
  background-color: #fff;
}

/* Markdown æ’ç‰ˆæ ·å¼ (ä»¿ GitHub) */
:deep(.markdown-body) {
  color: #24292f;
  line-height: 1.6;
}

:deep(h1) {
  font-size: 2.5em;
  padding-bottom: 0.3em;
  border-bottom: 1px solid #eaecef;
  margin-bottom: 24px;
  color: #1a5e38; /* æ ‡é¢˜ç”¨ä¸»é¢˜è‰² */
}

:deep(h2) {
  font-size: 1.75em;
  padding-bottom: 0.3em;
  border-bottom: 1px solid #eaecef;
  margin-top: 36px;
  margin-bottom: 20px;
}

:deep(h3) {
  font-size: 1.4em;
  margin-top: 24px;
  margin-bottom: 16px;
}

:deep(p) {
  margin-bottom: 16px;
}

:deep(blockquote) {
  padding: 0 1em;
  color: #6a737d;
  border-left: 0.25em solid #dfe2e5;
  background-color: #f6f8fa;
  padding: 16px;
  margin: 0 0 16px 0;
  border-radius: 4px;
}

:deep(pre) {
  background-color: #2d333b; /* ä»£ç å—æ·±è‰²èƒŒæ™¯ */
  padding: 16px;
  border-radius: 8px;
  overflow: auto;
  margin-bottom: 20px;
}

:deep(code) {
  font-family: 'Consolas', 'Monaco', monospace;
}

:deep(pre code) {
  color: #adbac7;
  background: transparent;
  padding: 0;
}

/* è¡Œå†…ä»£ç  */
:deep(:not(pre) > code) {
  padding: 0.2em 0.4em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(175, 184, 193, 0.2);
  border-radius: 6px;
}

:deep(ul) {
  padding-left: 2em;
  margin-bottom: 16px;
}

:deep(li) {
  margin-bottom: 4px;
}

.doc-footer {
  margin-top: 60px;
  padding-top: 20px;
  border-top: 1px solid #eee;
  text-align: center;
  color: #999;
  font-size: 12px;
}

/* æ»šåŠ¨æ¡ç¾åŒ– */
.doc-content::-webkit-scrollbar,
.doc-sidebar::-webkit-scrollbar {
  width: 6px;
}
.doc-content::-webkit-scrollbar-thumb,
.doc-sidebar::-webkit-scrollbar-thumb {
  background-color: #ddd;
  border-radius: 3px;
}
</style>