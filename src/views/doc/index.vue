<template>
  <div class="doc-container">
    <div class="doc-sidebar">
      <div class="sidebar-header">
        <el-icon><Reading /></el-icon> <span>CONTENTS</span>
      </div>
      <ul class="toc-list">
        <li 
          v-for="(item, index) in toc" 
          :key="index"
          :class="{ active: activeSection === item.id, 'sub-item': item.level > 1 }"
          @click="scrollTo(item.id)"
        >
          {{ item.text }}
        </li>
      </ul>
    </div>

    <div class="doc-content markdown-body" ref="contentRef" @scroll="handleScroll">
      <div v-html="parsedMarkdown"></div>
      
      <div class="doc-footer">
        Generated by Hometown System Generator &copy; 2025
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted, nextTick } from 'vue'
import { Reading } from '@element-plus/icons-vue'
import { marked } from 'marked'
import hljs from 'highlight.js'
import 'highlight.js/styles/github-dark-dimmed.css'

// --- ðŸ“ é¡¹ç›®æ ¸å¿ƒæ–‡æ¡£ (Markdown) ---
// æ³¨æ„ï¼šä¸‹é¢çš„ä»£ç å—ç¬¦å· ``` å‰é¢éƒ½åŠ äº†åæ–œæ  \ è½¬ä¹‰ï¼Œè¿™æ˜¯å¿…é¡»çš„ï¼
const markdownContent = `
# è¡¢å·žåœ°åŒºä¿¡æ¯ç®¡ç†ç³»ç»Ÿ (Hometown Management System)

> **ç‰ˆæœ¬**: v1.0.4
> **å¼€å‘è€…**: æ¯›é–æ™¨ (23H034160336)  
> **çŠ¶æ€**: ðŸš€ å·²ä¸Šçº¿ (Stable)

---

## 1. é¡¹ç›®æ¦‚è¿° (Overview)

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªè‡´åŠ›äºŽ**å¼˜æ‰¬è¡¢å·žæ–‡åŒ–ã€æŽ¨å¹¿åœ°æ–¹ç‰¹è‰²**çš„å…¨æ ˆä¿¡æ¯ç®¡ç†å¹³å°ã€‚ç³»ç»Ÿé›†æˆäº†**æ–‡åŒ–é—äº§å±•ç¤ºã€ç‰¹äº§æŽ¨å¹¿ã€æ—…æ¸¸æ™¯ç‚¹å¯¼èˆª**ä»¥åŠ**åŽå°æ•°æ®å¯è§†åŒ–ç®¡ç†**ç­‰åŠŸèƒ½ã€‚

é¡¹ç›®é‡‡ç”¨**å‰åŽç«¯åˆ†ç¦»**æž¶æž„ï¼Œåˆ†ä¸ºä¸‰ä¸ªç‹¬ç«‹å­ç³»ç»Ÿï¼š
1.  **åŽç«¯æœåŠ¡ (Core Server)**: åŸºäºŽ Spring Boot çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸Žæ•°æ®æŽ¥å£ã€‚
2.  **ç®¡ç†åŽå° (Admin Dashboard)**: åŸºäºŽ Vue3 + Element Plus çš„æ•°æ®ç®¡ç†ä¸Žå¯è§†åŒ–å¹³å°ã€‚
3.  **ç”¨æˆ·å‰å° (User Client)**: é¢å‘æ¸¸å®¢çš„æ²‰æµ¸å¼æ–‡åŒ–å±•ç¤ºé—¨æˆ·ã€‚

---

## 2. æŠ€æœ¯æ ˆ (Tech Stack)

### ðŸ› ï¸ åŽç«¯ (Backend)
-   **æ ¸å¿ƒæ¡†æž¶**: Spring Boot 2.7.x
-   **ORM**: MyBatis / MyBatis-Plus
-   **æ•°æ®åº“**: MySQL 8.0
-   **ç¼“å­˜**: Redis (ç”¨äºŽä¼šè¯ç®¡ç†ä¸Žçƒ­ç‚¹æ•°æ®ç¼“å­˜)
-   **å®‰å…¨**: JWT (JSON Web Token) é‰´æƒ, æ‹¦æˆªå™¨æœºåˆ¶
-   **ç›‘æŽ§**: OSHI (System Hardware Information) 
-   **å·¥å…·**: Swagger/Knife4j (æŽ¥å£æ–‡æ¡£), Lombok, FastJSON
-   **äº‘æœåŠ¡**: é˜¿é‡Œäº‘ OSS (å¯¹è±¡å­˜å‚¨)

### ðŸ’» å‰ç«¯ (Frontend)
-   **æ¡†æž¶**: Vue 3 (Composition API)
-   **æž„å»º**: Vite 4.x
-   **UI ç»„ä»¶åº“**: Element Plus
-   **å›¾è¡¨**: ECharts 5.x (æ•°æ®å¤§å±)
-   **åœ°å›¾**: ç™¾åº¦åœ°å›¾ JavaScript API GL
-   **è·¯ç”±**: Vue Router 4
-   **HTTP**: Axios (å°è£…è¯·æ±‚æ‹¦æˆªå™¨)

---

## 3. ç³»ç»Ÿæž¶æž„ (Architecture)

\`\`\`mermaid
graph TD
    User[ç”¨æˆ·] -->|æµè§ˆ/äº¤äº’| Client(ç”¨æˆ·å‰å°)
    Admin[ç®¡ç†å‘˜] -->|ç®¡ç†æ•°æ®| Dashboard(ç®¡ç†åŽå°)
    
    Client -->|API è¯·æ±‚| Gateway[Nginx / ç½‘å…³]
    Dashboard -->|API è¯·æ±‚| Gateway
    
    Gateway --> Server(Spring Boot åŽç«¯)
    
    Server -->|è¯»å†™| DB[(MySQL æ•°æ®åº“)]
    Server -->|ç¼“å­˜| Cache[(Redis)]
    Server -->|ç›‘æŽ§| Hardware[OSHI ç¡¬ä»¶ç›‘æŽ§]
    Server -->|å­˜å‚¨å›¾ç‰‡| OSS[é˜¿é‡Œäº‘ OSS]
\`\`\`

---

## 4. æ ¸å¿ƒåŠŸèƒ½æ¨¡å— (Modules)

### ðŸ—ºï¸ åˆ†å¸ƒåœ°å›¾ (Attraction Map) **[NEW]**
-   **å…¨åŸŸå¯¼è§ˆ**: é›†æˆç™¾åº¦åœ°å›¾ GLï¼Œç›´è§‚å±•ç¤ºè¡¢å·žæ‰€æœ‰æ™¯ç‚¹çš„åœ°ç†åˆ†å¸ƒã€‚
-   **æ™ºèƒ½å®šä½**: æ”¯æŒæ•°æ®åº“ç»çº¬åº¦ç›´æŽ¥æ‰“ç‚¹ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒåŸºäºŽåœ°å€çš„è‡ªåŠ¨è§£æžå…œåº•æ–¹æ¡ˆã€‚
-   **æ²‰æµ¸ä½“éªŒ**: 3D å€¾æ–œè§†è§’ + é£žè¡Œè·³è½¬åŠ¨ç”» (FlyTo)ï¼Œæä¾›æµç•…çš„äº‘æ¸¸ä½“éªŒã€‚

### ðŸ–¥ï¸ æœåŠ¡ç›‘æŽ§ (Server Monitor) **[NEW]**
-   **å®žæ—¶ä»ªè¡¨ç›˜**: å®žæ—¶ç›‘æŽ§æœåŠ¡å™¨çš„ CPU ä½¿ç”¨çŽ‡ã€å†…å­˜å ç”¨çŽ‡ã€‚
-   **çŽ¯å¢ƒä¿¡æ¯**: å±•ç¤ºæœåŠ¡å™¨æ“ä½œç³»ç»Ÿã€IP åœ°å€ã€Java ç‰ˆæœ¬ã€é¡¹ç›®è·¯å¾„ç­‰ã€‚
-   **ç£ç›˜æ£€æµ‹**: è‡ªåŠ¨æ‰«ææœåŠ¡å™¨ç£ç›˜åˆ†åŒºåŠä½¿ç”¨æƒ…å†µã€‚

### ðŸ›ï¸ æ–‡åŒ–é—äº§ (Culture)
-   **éžé—å±•ç¤º**: æ”¶å½•è¡¢å·žå„ç±»éžç‰©è´¨æ–‡åŒ–é—äº§ã€‚
-   **å›¾æ–‡è¯¦æƒ…**: æ”¯æŒå¯Œæ–‡æœ¬ä¸Žé«˜æ¸…å¤§å›¾å±•ç¤ºã€‚
-   **åŽå°ç®¡ç†**: CRUD æ“ä½œï¼Œæ”¯æŒä¸€é”®å‘å¸ƒä¸Žä¸‹æž¶ã€‚

### ðŸ— ç‰¹äº§ç¾Žé£Ÿ (Specialties)
-   **ç‰¹äº§åå½•**: ä¸‰å¤´ä¸€æŽŒã€çƒ¤é¥¼ç­‰ç‰¹è‰²ç¾Žé£Ÿä»‹ç»ã€‚
-   **æŽ¨èç®—æ³•**: (è®¡åˆ’ä¸­) åŸºäºŽç”¨æˆ·å–œå¥½çš„ä¸ªæ€§åŒ–æŽ¨èã€‚

### ðŸ“Š æ•°æ®å¤§å± (Dashboard)
-   **å®žæ—¶ç›‘æŽ§**: ç”¨æˆ·è®¿é—®é‡ã€API è°ƒç”¨é¢‘çŽ‡ã€‚
-   **å¯è§†åŒ–**: ä½¿ç”¨ ECharts å±•ç¤ºâ€œç‰¹äº§åˆ†ç±»å æ¯”â€ã€â€œçƒ­é—¨æ™¯ç‚¹æŽ’è¡Œâ€ç­‰å›¾è¡¨ã€‚

### ðŸ“ æ—¥å¿—å®¡è®¡ (Audit Log)
-   **æ“ä½œæ—¥å¿—**: è®°å½•ç®¡ç†å‘˜çš„æ‰€æœ‰æ•æ„Ÿæ“ä½œ (æ–°å¢žã€åˆ é™¤ã€ä¿®æ”¹)ã€‚
-   **ç™»å½•æ—¥å¿—**: ç›‘æŽ§å¼‚å¸¸ç™»å½•è¡Œä¸ºï¼Œä¿éšœç³»ç»Ÿå®‰å…¨ã€‚

---

## 5. æ ¸å¿ƒä»£ç ç‰‡æ®µ (Code Snippets)

### ðŸ“¡ 1. OSHI èŽ·å–ç³»ç»Ÿä¿¡æ¯ (Java)
\`\`\`java
public void copyTo() throws Exception {
    SystemInfo si = new SystemInfo();
    HardwareAbstractionLayer hal = si.getHardware();

    setCpuInfo(hal.getProcessor());
    setMemInfo(hal.getMemory());
    setSysInfo();
    setJvmInfo();
    setSysFiles(si.getOperatingSystem());
}
\`\`\`

### ðŸ—ºï¸ 2. ç™¾åº¦åœ°å›¾æ™ºèƒ½æ‰“ç‚¹ (JavaScript)
\`\`\`javascript
const addCreativeMarker = (item) => {
  // ðŸŸ¢ ä¼˜å…ˆä½¿ç”¨æ•°æ®åº“ç»çº¬åº¦ (é«˜æ€§èƒ½)
  if (item.longitude && item.latitude) {
    const point = new BMapGL.Point(item.longitude, item.latitude)
    createMarkerLogic(point, item)
  } else {
    // ðŸŸ¡ å…œåº•ï¼šä½¿ç”¨åœ°å€è§£æž (å…¼å®¹æ—§æ•°æ®)
    const myGeo = new BMapGL.Geocoder()
    myGeo.getPoint('è¡¢å·žå¸‚ ' + (item.location || item.name), (p) => {
      if (p) createMarkerLogic(p, item)
    }, 'è¡¢å·žå¸‚')
  }
}
\`\`\`

---

## 6. éƒ¨ç½²æŒ‡å— (Deployment)

### çŽ¯å¢ƒè¦æ±‚
-   JDK 1.8+
-   Node.js 16+
-   MySQL 5.7+
-   Redis 5.0+

### å¯åŠ¨æ­¥éª¤
1.  **æ•°æ®åº“**: å¯¼å…¥ \`init.sql\` (åŒ…å«æ–°å¢žçš„ longitude/latitude å­—æ®µ)ã€‚
2.  **åŽç«¯**: ä¿®æ”¹ \`application.yml\` ä¸­çš„ DB/Redis é…ç½®ï¼Œè¿è¡Œ \`HometownApplication.java\`ã€‚
3.  **å‰ç«¯**: 
    \`\`\`bash
    cd vue_hometown_management
    npm install
    npm run dev
    \`\`\`

---

## 7. æ›´æ–°æ—¥å¿— (Changelog)

-   **v1.0.4 (2025-12-19)**:
    -   âœ¨ **[Feature]** æ–°å¢ž **â€œåˆ†å¸ƒåœ°å›¾â€** æ¨¡å—ï¼Œæ”¯æŒå…¨å± 3D åœ°å›¾å¯¼è§ˆã€‚
    -   âœ¨ **[Feature]** æ–°å¢ž **â€œæœåŠ¡ç›‘æŽ§â€** æ¨¡å—ï¼ŒåŸºäºŽ OSHI å®žæ—¶å±•ç¤ºæœåŠ¡å™¨çŠ¶æ€ã€‚
    -   ðŸ”§ **[Database]** \`attraction\` è¡¨æ–°å¢ž \`longitude\` å’Œ \`latitude\` å­—æ®µã€‚
    -   ðŸ’„ **[UI]** ä¼˜åŒ–äº†ä¾§è¾¹æ å¸ƒå±€ï¼Œä¿®å¤äº†åœ°å›¾é¡µé¢çš„ç•™ç™½å’Œé®æŒ¡é—®é¢˜ã€‚
    -   ðŸ”’ **[Security]** ç”¨æˆ·ç«¯ç‚¹èµž/å·®è¯„å¢žåŠ ç™»å½•æ‹¦æˆªæ ¡éªŒã€‚

-   **v1.0.3 (2025-12-18)**: 
    -   âœ¨ æ–°å¢žâ€œç³»ç»Ÿè¿›åŒ– (DevLog)â€æ¨¡å—ï¼Œæ”¯æŒå¤šä»“åº“æäº¤è®°å½•æŸ¥çœ‹ã€‚
    -   ðŸ› ä¿®å¤äº†æ™¯ç‚¹å›¾ç‰‡ä¸Šä¼ ä¸æ˜¾ç¤ºçš„ Bugã€‚

-   **v1.0.2 (2025-12-17)**: 
    -   ðŸ’„ ä¼˜åŒ–åŽå° UIï¼Œå¢žåŠ èµ›åšæœ‹å…‹é£Žæ ¼ç»„ä»¶ã€‚
    -   ðŸ“ˆ å®Œå–„ ECharts æ•°æ®å¤§å±ã€‚

-   **v1.0.0 (2025-12-01)**: 
    -   ðŸŽ‰ é¡¹ç›®åˆå§‹åŒ–ï¼Œå®ŒæˆåŸºç¡€ CRUD åŠŸèƒ½ã€‚

---

> **Copyright**: 2025 è¡¢å·žåœ°åŒºä¿¡æ¯ç®¡ç†ç³»ç»Ÿ Team. All Rights Reserved.
`

// --- é€»è¾‘å¤„ç† ---
const contentRef = ref(null)
const activeSection = ref('')

// é…ç½® Marked
marked.setOptions({
  renderer: new marked.Renderer(),
  highlight: function(code, lang) {
    const language = hljs.getLanguage(lang) ? lang : 'plaintext';
    return hljs.highlight(code, { language }).value;
  },
  langPrefix: 'hljs language-',
  pedantic: false,
  gfm: true,
  breaks: false,
  sanitize: false,
  smartLists: true,
  smartypants: false,
  xhtml: false
});

const parsedMarkdown = computed(() => marked(markdownContent))

// ç”Ÿæˆç›®å½• (TOC)
const toc = computed(() => {
  const reg = /^#+\s+(.*)$/gm
  const matches = markdownContent.match(reg) || []
  return matches.map((item, index) => {
    const level = item.match(/^#+/)[0].length
    const text = item.replace(/^#+\s+/, '')
    const id = `heading-${index}`
    return { level, text, id }
  })
})

// ä¸ºç”Ÿæˆçš„ HTML æ·»åŠ  ID ä»¥ä¾¿è·³è½¬
onMounted(async () => {
  await nextTick()
  const headers = contentRef.value.querySelectorAll('h1, h2, h3')
  headers.forEach((header, index) => {
    header.id = `heading-${index}`
  })
})

// æ»šåŠ¨è·³è½¬
const scrollTo = (id) => {
  const el = document.getElementById(id)
  if (el) {
    el.scrollIntoView({ behavior: 'smooth' })
    activeSection.value = id
  }
}

const handleScroll = () => {
  // scroll logic
}
</script>

<style scoped>
/* æ ·å¼ä¿æŒä¸å˜ */
.doc-container {
  display: flex;
  height: 100%;
  background-color: #ffffff;
  font-family: 'Segoe UI', sans-serif;
  overflow: hidden; 
}

.doc-sidebar {
  width: 280px;
  background-color: #f8f9fa;
  border-right: 1px solid #e9ecef;
  padding: 30px 20px;
  overflow-y: auto;
  flex-shrink: 0;
}

.sidebar-header {
  font-size: 14px;
  font-weight: 800;
  color: #adb5bd;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 8px;
  letter-spacing: 1px;
}

.toc-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.toc-list li {
  padding: 8px 12px;
  font-size: 14px;
  color: #495057;
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.2s;
  margin-bottom: 4px;
  border-left: 3px solid transparent;
}

.toc-list li:hover {
  background-color: #e9ecef;
  color: #212529;
}

.toc-list li.active {
  background-color: #e7f5ff;
  color: #1a5e38;
  border-left-color: #1a5e38;
  font-weight: 600;
}

.toc-list li.sub-item {
  padding-left: 25px;
  font-size: 13px;
  color: #868e96;
}

.doc-content {
  flex: 1;
  padding: 40px 60px;
  overflow-y: auto;
  scroll-behavior: smooth;
  background-color: #fff;
}

:deep(.markdown-body) {
  color: #24292f;
  line-height: 1.6;
}

:deep(h1) {
  font-size: 2.5em;
  padding-bottom: 0.3em;
  border-bottom: 1px solid #eaecef;
  margin-bottom: 24px;
  color: #1a5e38;
}

:deep(h2) {
  font-size: 1.75em;
  padding-bottom: 0.3em;
  border-bottom: 1px solid #eaecef;
  margin-top: 36px;
  margin-bottom: 20px;
}

:deep(h3) {
  font-size: 1.4em;
  margin-top: 24px;
  margin-bottom: 16px;
}

:deep(p) {
  margin-bottom: 16px;
}

:deep(blockquote) {
  padding: 0 1em;
  color: #6a737d;
  border-left: 0.25em solid #dfe2e5;
  background-color: #f6f8fa;
  padding: 16px;
  margin: 0 0 16px 0;
  border-radius: 4px;
}

:deep(pre) {
  background-color: #2d333b; 
  padding: 16px;
  border-radius: 8px;
  overflow: auto;
  margin-bottom: 20px;
}

:deep(code) {
  font-family: 'Consolas', 'Monaco', monospace;
}

:deep(pre code) {
  color: #adbac7;
  background: transparent;
  padding: 0;
}

:deep(:not(pre) > code) {
  padding: 0.2em 0.4em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(175, 184, 193, 0.2);
  border-radius: 6px;
}

:deep(ul) {
  padding-left: 2em;
  margin-bottom: 16px;
}

:deep(li) {
  margin-bottom: 4px;
}

.doc-footer {
  margin-top: 60px;
  padding-top: 20px;
  border-top: 1px solid #eee;
  text-align: center;
  color: #999;
  font-size: 12px;
}

.doc-content::-webkit-scrollbar,
.doc-sidebar::-webkit-scrollbar {
  width: 6px;
}
.doc-content::-webkit-scrollbar-thumb,
.doc-sidebar::-webkit-scrollbar-thumb {
  background-color: #ddd;
  border-radius: 3px;
}
</style>